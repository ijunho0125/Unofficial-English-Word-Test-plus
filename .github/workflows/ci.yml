name: Build Android APK

on:
  push:
    branches:
      - main  # main ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì‹¤í–‰ (ì›í•˜ëŠ” ëŒ€ë¡œ ìˆ˜ì •)

jobs:
  build:
    runs-on: ubuntu-latest # GitHubì—ì„œ ì œê³µí•˜ëŠ” ë¦¬ëˆ…ìŠ¤ í™˜ê²½ (Android SDK í¬í•¨ë¨)

    steps:
      - name: ğŸ— Setup repo
        uses: actions/checkout@v3

      - name: ğŸ— Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18 # í”„ë¡œì íŠ¸ì— ë§ëŠ” ë²„ì „ ì‚¬ìš©
          cache: 'npm' # or 'yarn'

      - name: ğŸ— Setup Java
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '17' # React Native ìµœì‹  ë²„ì „ì€ ë³´í†µ 17 í•„ìš”

      - name: ğŸ“¦ Install dependencies
        run: npm install

      - name: ğŸš€ Install EAS CLI
        run: npm install -g eas-cli

      - name: ğŸ‘· Build APK (Local Build on Runner)
        # ì¤‘ìš”: --local ì˜µì…˜ì„ ì¨ì•¼ Expo í´ë¼ìš°ë“œë¥¼ ì•ˆ ì“°ê³  GitHub ì„œë²„ ìì›ì„ ì”ë‹ˆë‹¤.
        # --non-interactive: CI í™˜ê²½ì´ë¼ ì‚¬ëŒì´ ì…ë ¥ì„ ëª» í•˜ë¯€ë¡œ í•„ìˆ˜
        run: eas build --platform android --profile preview --local --non-interactive
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}

      - name: ğŸ“¤ Upload APK to GitHub Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: app-release
          path: android/app/build/outputs/apk/release/app-release.apk
          # ìœ„ ê²½ë¡œëŠ” í”„ë¡œì íŠ¸ ì„¤ì •ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
          # ë³´í†µ eas build --local ê²°ê³¼ë¬¼ì€ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìƒê¸°ê±°ë‚˜ build í´ë” ì•ˆì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.